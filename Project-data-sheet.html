<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maxwell Stamp Projects Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
            width: 100%;
            min-height: auto;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
        }

        /* Mobile Header */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: white;
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .mobile-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .mobile-header h1 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1e293b;
        }

        .mobile-menu-btn {
            background: none;
            border: none;
            font-size: 1.3rem;
            color: #64748b;
            cursor: pointer;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .mobile-menu-btn:active {
            background-color: #f1f5f9;
        }

        /* Desktop Header */
        .main-header {
            padding: 10px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .header-text p {
            color: #64748b;
            font-size: 1rem;
        }

        .stats-section {
            display: flex;
            gap: 30px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #f63b3b;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #535b66;
            font-weight: 600;
        }

        /* Main Content Area */
        .main-content {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            min-height: 0;
            margin-top: 0;
        }

        /* Left Panel: Cards */
        .cards-panel {
            flex: 0 0 40%;
            min-width: 0;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            height: calc(100vh - 40px);
            position: sticky;
            top: 20px;
        }

        .cards-header {
            padding: 25px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            flex-shrink: 0;
        }

        .cards-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #ff2e2e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }

        .search-box input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .filter-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        select {
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            background-color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            padding-right: 40px;
        }

        select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .clear-filters-btn {
            grid-column: span 2;
            padding: 12px 15px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: none;
        }

        .clear-filters-btn:active {
            background: #e2e8f0;
            transform: scale(0.98);
        }

        /* Cards Grid Container */
        .cards-grid-container {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            -webkit-overflow-scrolling: touch;
        }

        /* Simplified Cards Grid */
        .cards-grid {
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 12px;
            flex: 1;
            min-height: 0;
        }

        /* SIMPLIFIED PROJECT CARD */
        .project-card {
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 70px;
            touch-action: manipulation;
            scroll-margin-top: 0;
        }

        .project-card:active {
            transform: scale(0.98);
        }

        .project-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            border-radius: 12px 0 0 12px;
        }

        /* Status-based colors */
        .project-card.status-green::before {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .project-card.status-yellow::before {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .project-card.status-red::before {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .project-card.status-default::before {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        }

        /* Background colors for the entire card based on status */
        .project-card.status-green {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #86efac;
        }

        .project-card.status-yellow {
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            border-color: #fde047;
        }

        .project-card.status-red {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #fca5a5;
        }

        .project-card.status-default {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-color: #cbd5e1;
        }

        .project-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .project-card.selected {
            transform: translateY(-1px);
            box-shadow: 0 12px 20px rgba(59, 130, 246, 0.15);
            border-color: #3b82f6;
            background: white;
        }

        .card-content {
            flex: 1;
            padding-right: 15px;
            min-width: 0;
        }

        .project-name {
            font-size: 1rem;
            font-weight: 700;
            color: #1e293b;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            word-break: break-word;
        }

        .project-code {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 600;
            margin-top: 4px;
        }

        .card-status {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
            flex-shrink: 0;
            margin-left: 10px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            white-space: nowrap;
        }

        .status-indicator.green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .status-indicator.yellow {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .status-indicator.red {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .status-indicator.default {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        }

        .status-date {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 600;
            text-align: right;
        }

        .overdue-badge {
            background: #ef4444;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-top: 6px;
            display: inline-block;
        }

        /* Right Panel: Details */
        .details-panel {
            flex: 0 0 60%;
            min-width: 0;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            height: calc(100vh - 40px);
            position: sticky;
            top: 20px;
        }

        .panel-header {
            padding: 25px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            flex-shrink: 0;
        }

        .panel-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1e293b;
        }

        .panel-subtitle {
            font-size: 1rem;
            color: #64748b;
            margin-top: 5px;
        }

        .details-content {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            position: relative;
            overflow: hidden;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px;
            text-align: center;
            color: #64748b;
            flex: 1;
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #cbd5e1;
        }

        .empty-state h3 {
            font-size: 1.6rem;
            margin-bottom: 12px;
            color: #475569;
        }

        .empty-state p {
            max-width: 400px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* Project Details View */
        .project-details-view {
            display: none;
            flex-direction: column;
            height: 100%;
            min-height: 0;
            position: relative;
            scroll-behavior: smooth;
        }

        .project-details-view.active {
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 0;
        }

        /* Mobile Back Header */
        .mobile-details-header {
            display: none;
            position: sticky;
            top: 0;
            z-index: 100;
            background: white;
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .mobile-details-header-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .back-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #64748b;
            cursor: pointer;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }

        .back-btn:active {
            background-color: #f1f5f9;
        }

        .mobile-details-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .details-header {
            padding: 15px;
            color: white;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .details-header.on-track {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .details-header.at-risk {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .details-header.critical {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .details-header.default {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }

        .details-header::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 200px;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.1) 100%);
            pointer-events: none;
        }

        .details-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            word-break: break-word;
        }

        .details-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        /* DETAILS BODY - FIXED FOR FOOTER */
        .details-body {
            padding: 25px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
            min-height: 0;
            position: relative;
            scroll-behavior: smooth;
        }

        /* Financial Cards */
        .financial-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .financial-card {
            background: white;
            padding: 18px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .financial-card:active {
            transform: scale(0.98);
        }

        .financial-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #059669;
            margin-bottom: 6px;
        }

        .financial-label {
            font-size: 0.85rem;
            color: #64748b;
            font-weight: 600;
        }

        /* Details Sections */
        .details-sections {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .details-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .details-section-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #1e293b;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        .detail-item {
            margin-bottom: 12px;
        }

        .detail-item-label {
            font-weight: 600;
            color: #64748b;
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .detail-item-value {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.95rem;
            word-break: break-word;
        }

        .description-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .description-label {
            font-weight: 700;
            color: #64748b;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .description-value {
            color: #1e293b;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        /* Links and Resources Section */
        .links-resources-section {
            background: #f8fafc;
            padding: 10px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            margin: 20px 0px;
        }

        .links-resources-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 0px;
        }

        .resource-card {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            text-decoration: none;
            color: inherit;
        }

        .resource-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
        }

        .resource-icon {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #3b82f6;
        }

        .resource-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #1e293b;
        }

        .resource-value {
            font-size: 0.85rem;
            color: #64748b;
            word-break: break-word;
        }

        .resource-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: #3b82f6;
            font-weight: 600;
            font-size: 0.85rem;
            margin-top: 5px;
            text-decoration: none;
        }

        .resource-link:hover {
            text-decoration: underline;
        }

        /* Loading and Error States */
        .loading {
            text-align: center;
            padding: 60px 30px;
            font-size: 1.2rem;
            color: #64748b;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .error {
            text-align: center;
            padding: 60px 30px;
            background-color: #fef2f2;
            color: #dc2626;
            border-radius: 12px;
            margin: 20px;
            border: 1px solid #fecaca;
        }

        .no-results {
            text-align: center;
            padding: 60px 30px;
            background-color: #f8fafc;
            color: #64748b;
            border-radius: 12px;
            margin: 20px;
            border: 1px solid #e2e8f0;
        }

        /* ============== RESPONSIVE BREAKPOINTS ============== */

        /* Large tablets and small desktops */
        @media (max-width: 1200px) {
            .main-content {
                padding: 15px;
                gap: 15px;
            }

            .financial-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }

            .cards-panel,
            .details-panel {
                height: calc(100vh - 30px);
            }

            .links-resources-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Tablets */
        @media (max-width: 992px) {
            .main-header {
                padding: 15px 20px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .stats-section {
                width: 100%;
                justify-content: space-between;
                gap: 20px;
            }

            .stat-value {
                font-size: 1.3rem;
            }

            .details-sections {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .cards-panel {
                flex: 0 0 45%;
            }

            .details-panel {
                flex: 0 0 55%;
            }

            .links-resources-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .mobile-header {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1000;
                background: white;
                padding: 12px 15px;
                border-bottom: 1px solid #e2e8f0;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                height: 60px;
                box-sizing: border-box;
            }

            .mobile-details-header {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1000;
                background: white;
                padding: 12px 15px;
                border-bottom: 1px solid #e2e8f0;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                height: 60px;
                box-sizing: border-box;
            }

            .main-header {
                display: none;
            }

            .main-content {
                flex-direction: column;
                padding: 0;
                gap: 0;
                margin-top: 60px;
                height: calc(100vh - 60px);
                width: 100%;
                position: relative;
                overflow: hidden;
            }

            .cards-panel,
            .details-panel {
                width: 100%;
                height: 100%;
                border-radius: 0;
                border: none;
                box-shadow: none;
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                display: none;
                flex-direction: column;
                overflow: hidden;
            }

            .cards-panel {
                display: flex;
            }

            .details-panel {
                display: none;
            }

            .details-panel.active {
                display: flex;
            }

            .cards-panel.hidden {
                display: none;
            }

            .panel-header {
                display: none;
            }

            .cards-header {
                padding: 20px;
                flex-shrink: 0;
            }

            .cards-title {
                font-size: 1.2rem;
                margin-bottom: 12px;
            }

            .filter-section {
                grid-template-columns: 1fr;
            }

            .clear-filters-btn {
                grid-column: span 1;
            }

            .cards-grid-container {
                flex: 1;
                min-height: 0;
                overflow-y: auto;
            }

            .cards-grid {
                padding: 15px;
                min-height: 0;
            }

            .project-card {
                padding: 10px;
                min-height: 65px;
            }

            .project-name {
                font-size: 0.95rem;
            }

            .status-indicator {
                font-size: 0.8rem;
                padding: 5px 10px;
            }

            .details-header {
                padding: 20px;
            }

            .details-title {
                font-size: 1.3rem;
            }

            .details-subtitle {
                font-size: 1rem;
            }

            .financial-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .financial-card {
                padding: 15px;
            }

            .financial-value {
                font-size: 1.1rem;
            }

            .details-body {
                padding: 20px;
                flex: 1;
                min-height: 0;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .links-resources-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .resource-card {
                padding: 12px;
            }

            .resource-icon {
                font-size: 1.3rem;
            }

            .details-panel.active .project-details-view {
                display: flex !important;
                flex-direction: column;
                height: 100%;
            }

            .details-panel.active .empty-state {
                display: none;
            }

            .details-panel.active .details-content {
                display: flex;
                flex-direction: column;
                height: 100%;
            }

            .details-panel.active .project-details-view {
                flex: 1;
                min-height: 0;
            }
        }

        /* Mobile Phones */
        @media (max-width: 576px) {
            .mobile-header {
                padding: 10px 12px;
            }

            .mobile-details-header {
                padding: 10px 12px;
            }

            .mobile-header h1 {
                font-size: 1.1rem;
            }

            .cards-header {
                padding: 15px;
            }

            .search-box input,
            select,
            .clear-filters-btn {
                padding: 10px 12px 10px 40px;
                font-size: 0.95rem;
            }

            .search-icon {
                left: 12px;
                font-size: 1rem;
            }

            select {
                background-position: right 12px center;
                padding-right: 35px;
            }

            .cards-grid {
                padding: 12px;
                gap: 10px;
            }

            .project-card {
                padding: 12px 14px;
                min-height: 60px;
            }

            .project-name {
                font-size: 0.9rem;
            }

            .project-code {
                font-size: 0.75rem;
            }

            .status-indicator {
                font-size: 0.75rem;
                padding: 4px 8px;
            }

            .status-date {
                font-size: 0.7rem;
            }

            .overdue-badge {
                font-size: 0.65rem;
                padding: 2px 6px;
            }

            .financial-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .details-header {
                padding: 5px 10px;
            }

            .details-title {
                font-size: 1.2rem;
            }

            .details-subtitle {
                font-size: 0.95rem;
            }

            .details-body {
                padding: 15px;
            }

            .details-section {
                padding: 15px;
            }

            .description-card {
                padding: 15px;
            }

            .links-resources-section {
                padding: 15px;
            }

            .links-resources-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .resource-card {
                padding: 15px;
            }
        }

        /* Very Small Phones */
        @media (max-width: 375px) {
            .project-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                min-height: auto;
            }

            .card-content {
                padding-right: 0;
                width: 100%;
            }

            .card-status {
                width: 100%;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                margin-left: 0;
            }

            .status-date {
                font-size: 0.75rem;
            }

            .filter-section {
                grid-template-columns: 1fr;
            }

            .clear-filters-btn span {
                display: none;
            }

            .clear-filters-btn i {
                margin: 0;
            }

            .financial-grid {
                grid-template-columns: 1fr;
            }

            .links-resources-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* iOS Safari specific fixes */
        @supports (-webkit-touch-callout: none) {

            .cards-panel,
            .details-panel {
                height: calc(100vh - 60px);
            }

            .main-content {
                height: calc(100vh - 60px);
            }
        }

        /* Prevent text size adjustment on orientation change */
        html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        /* Improve touch targets */
        button,
        select,
        .project-card {
            min-height: 44px;
        }
    </style>
</head>

<body>
    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <div class="mobile-logo">
                <h1>Projects Dashboard</h1>
            </div>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>

    <!-- Mobile Details Header -->
    <div class="mobile-details-header" id="mobileDetailsHeader">
        <div class="mobile-details-header-content">
            <button class="back-btn" id="mobileBackBtn">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="mobile-details-title" id="mobileDetailsTitle">Project Details</div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content" id="mainContent">
        <!-- Left Panel: Cards -->
        <div class="cards-panel" id="cardsPanel">
            <div class="cards-header">
                <h2 class="cards-title">
                    <i class="fas fa-project-diagram"></i>
                    Project Portfolio
                </h2>
                <div class="controls">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchInput" placeholder="Search projects...">
                    </div>
                    <div class="filter-section">
                        <select id="statusFilter">
                            <option value="">All Status</option>
                            <option value="ðŸŸ¢">On Track</option>
                            <option value="ðŸŸ¡">At Risk</option>
                            <option value="ðŸ”´">Critical</option>
                        </select>
                        <select id="sectorFilter">
                            <option value="">All Sectors</option>
                        </select>
                        <button id="clearFiltersBtn" class="clear-filters-btn">
                            <i class="fas fa-filter-circle-xmark"></i>
                            <span>Clear Filters</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="cards-grid-container">
                <div class="cards-grid" id="projectsGrid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading projects...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Details View -->
        <div class="details-panel" id="detailsPanel">
            <div class="panel-header">
                <h2 class="panel-title">Project Details</h2>
                <p class="panel-subtitle">Select a project to view detailed information</p>
            </div>

            <div class="details-content">
                <!-- Empty State -->
                <div class="empty-state" id="emptyState">
                    <i class="fas fa-file-alt"></i>
                    <h3>No Project Selected</h3>
                    <p>Select a project from the list to view its detailed information here.</p>
                </div>

                <!-- Project Details View -->
                <div class="project-details-view" id="projectDetailsView">
                    <div class="details-header default" id="detailsHeader">
                        <h2 class="details-title" id="detailsProjectName">Project Name</h2>
                        <p class="details-subtitle" id="detailsClientName">Client Name</p>
                    </div>

                    <div class="details-body" id="detailsBody">
                        <!-- Financial Cards will be inserted here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_CONFIG = {
            URL: "https://woklvqytrxauxosurmyv.supabase.co",
            API_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indva2x2cXl0cnhhdXhvc3VybXl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwNDI1NjgsImV4cCI6MjA3OTYxODU2OH0.e0Uaxxk9cdvVqBJYZcXwdtWb4WsJf1IIaclFZ7Ac0lQ"
        };

        const TABLE_NAME = 'projects';

        // DOM Elements
        const projectsGrid = document.getElementById('projectsGrid');
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const sectorFilter = document.getElementById('sectorFilter');
        const clearFiltersBtn = document.getElementById('clearFiltersBtn');
        const emptyState = document.getElementById('emptyState');
        const projectDetailsView = document.getElementById('projectDetailsView');
        const detailsBody = document.getElementById('detailsBody');
        const cardsPanel = document.getElementById('cardsPanel');
        const detailsPanel = document.getElementById('detailsPanel');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileBackBtn = document.getElementById('mobileBackBtn');
        const mobileDetailsHeader = document.getElementById('mobileDetailsHeader');
        const mobileDetailsTitle = document.getElementById('mobileDetailsTitle');

        // Details panel elements
        const detailsHeader = document.getElementById('detailsHeader');
        const detailsProjectName = document.getElementById('detailsProjectName');
        const detailsClientName = document.getElementById('detailsClientName');

        // Currency conversion rates (to USD)
        const conversionRates = {
            'USD': 1, '$': 1, 'US$': 1,
            'PKR': 0.0036, 'INR': 0.012, 'EUR': 1.08, 'â‚¬': 1.08,
            'GBP': 1.27, 'Â£': 1.27, 'CAD': 0.73, 'AUD': 0.66,
            'JPY': 0.0067, 'CNY': 0.14, 'CHF': 1.12, 'AED': 0.27,
            'SAR': 0.27, 'BDT': 0.0091, 'LKR': 0.0031, 'NPR': 0.0075,
            'MMK': 0.00048, 'IDR': 0.000064, 'THB': 0.027, 'PHP': 0.018,
            'VND': 0.000041, 'MYR': 0.21, 'SGD': 0.74, 'HKD': 0.13,
            'KRW': 0.00075, 'BRL': 0.20, 'MXN': 0.059, 'RUB': 0.011,
            'ZAR': 0.055, 'NGN': 0.00067, 'EGP': 0.032, 'KES': 0.0068,
            'GHS': 0.078, 'ETB': 0.018
        };

        // Store data
        let allData = [];
        let filteredData = [];
        let selectedProjectId = null;
        let isMobile = window.innerWidth <= 768;

        // Initialize
        checkMobileView();
        window.addEventListener('resize', checkMobileView);

        // Event listeners
        mobileBackBtn.addEventListener('click', handleMobileBack);
        mobileMenuBtn.addEventListener('click', toggleMobileView);
        clearFiltersBtn.addEventListener('click', clearAllFilters);
        searchInput.addEventListener('input', filterProjects);
        statusFilter.addEventListener('change', filterProjects);
        sectorFilter.addEventListener('change', filterProjects);

        // Prevent form submission on enter
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
            }
        });

        // Mobile view handling
        function checkMobileView() {
            isMobile = window.innerWidth <= 768;

            if (isMobile) {
                mobileDetailsHeader.style.display = 'none';
                cardsPanel.style.display = 'flex';
                detailsPanel.style.display = 'none';
                mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
            } else {
                mobileDetailsHeader.style.display = 'none';
                cardsPanel.style.display = 'flex';
                detailsPanel.style.display = 'flex';
            }
        }

        function toggleMobileView() {
            if (isMobile) {
                if (detailsPanel.classList.contains('active')) {
                    showCardsView();
                } else if (selectedProjectId) {
                    const project = allData.find(p => p.id == selectedProjectId);
                    if (project) {
                        showDetailsView(project);
                    }
                }
            }
        }

        function showCardsView() {
            if (isMobile) {
                cardsPanel.style.display = 'flex';
                detailsPanel.style.display = 'none';
                detailsPanel.classList.remove('active');
                mobileDetailsHeader.style.display = 'none';
                mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
            }
        }

        function showDetailsView(project) {
            if (isMobile) {
                cardsPanel.style.display = 'none';
                detailsPanel.style.display = 'flex';
                detailsPanel.classList.add('active');
                mobileDetailsHeader.style.display = 'block';
                mobileDetailsTitle.textContent = project.project_name || 'Project Details';
                mobileMenuBtn.innerHTML = '<i class="fas fa-list"></i>';
            }
        }

        // Function to detect currency from string
        function detectCurrency(amountString) {
            if (!amountString) return 'USD';
            const upperStr = amountString.toUpperCase();

            if (upperStr.includes('US$')) return 'USD';
            if (upperStr.includes('PKR') || upperStr.includes('RS')) return 'PKR';
            if (upperStr.includes('INR') || upperStr.includes('â‚¹')) return 'INR';
            if (upperStr.includes('EUR') || upperStr.includes('â‚¬')) return 'EUR';
            if (upperStr.includes('GBP') || upperStr.includes('Â£')) return 'GBP';
            if (upperStr.includes('BDT') || upperStr.includes('à§³')) return 'BDT';
            if (/\$/.test(amountString)) return 'USD';
            if (/\d/.test(amountString)) return 'USD';

            return 'USD';
        }

        // Extract and convert amount to USD
        function extractAndConvertToUSD(amountString) {
            if (!amountString || amountString.trim() === '') return 0;
            const amount = amountString.trim();
            let totalUSD = 0;

            const singleAmountMatch = amount.match(/^([^0-9]*?)([\d,.]+)$/);
            if (singleAmountMatch && !amount.toLowerCase().includes('and')) {
                const [, currencyPart, numericPart] = singleAmountMatch;
                const numericValue = parseFloat(numericPart.replace(/,/g, '')) || 0;
                const currency = detectCurrency(currencyPart.trim() || amount);
                const rate = conversionRates[currency] || 1;
                return numericValue * rate;
            }

            const parts = amount.split(/\s+and\s+/i);
            parts.forEach(part => {
                const trimmedPart = part.trim();
                if (!trimmedPart) return;

                const numericMatch = trimmedPart.match(/([\d,.]+)/);
                if (!numericMatch) return;

                const numericString = numericMatch[1].replace(/,/g, '');
                const numericValue = parseFloat(numericString) || 0;

                if (numericValue > 0) {
                    const currency = detectCurrency(trimmedPart);
                    const rate = conversionRates[currency] || 1;
                    totalUSD += numericValue * rate;
                }
            });

            return totalUSD;
        }

        // Calculate funding progress
        function calculateFundingProgress(contractAmountUSD, fundReceivedUSD) {
            if (!contractAmountUSD || contractAmountUSD <= 0) return 0;
            if (!fundReceivedUSD || fundReceivedUSD <= 0) return 0;

            const percentage = (fundReceivedUSD / contractAmountUSD) * 100;
            return Math.min(percentage, 100);
        }

        // Check if project is overdue
        function isProjectOverdue(project) {
            if (!project.end_date) return false;
            const endDate = new Date(project.end_date);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return endDate < today;
        }

        // Fetch projects
        async function fetchProjects() {
            try {
                const response = await fetch(`${SUPABASE_CONFIG.URL}/rest/v1/${TABLE_NAME}?select=*`, {
                    headers: {
                        'apikey': SUPABASE_CONFIG.API_KEY,
                        'Authorization': `Bearer ${SUPABASE_CONFIG.API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error(`Failed to fetch: ${response.status}`);
                let data = await response.json();

                // Sort data by 'sl' field in ascending order
                if (data && Array.isArray(data)) {
                    data.sort((a, b) => (a.sl || 0) - (b.sl || 0));
                    processProjects(data);
                }
            } catch (error) {
                console.error('Error:', error);
                projectsGrid.innerHTML = `
                <div class="error">
                    <h3>Error Loading Projects</h3>
                    <p>${error.message}</p>
                    <button onclick="fetchProjects()" style="margin-top: 15px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-redo"></i> Retry
                    </button>
                </div>
            `;
            }
        }

        function processProjects(data) {
            allData = data.map((row, index) => {
                const project = {
                    id: row.sl || index + 1,
                    awarded_year: row.awarded_year || '',
                    country: row.country || '',
                    donor_name: row.donor_name || '',
                    client_name: row.client_name || '',
                    project_name: row.project_name || '',
                    sector: row.sector || '',
                    lead: row.lead || '',
                    partner: row.partner || '',
                    project_code: row.project_code || '',
                    assigned_to: row.assigned_to || '',
                    contract_start_date: row.contract_start_date || '',
                    end_date: row.end_date || '',
                    status: row.status || '',
                    current_progress: row.current_progress || '',
                    key_risk_challenges: row.key_risk_challenges || '',
                    next_milestone: row.next_milestone || '',
                    contract_amount: row.contract_amount || '',
                    fund_claimed: row.fund_claimed || '',
                    fund_received: row.fund_received || '',
                    total_due: row.total_due || '',
                    remark: row.remark || '',
                    links: row.links || null,
                    sheet_source: row.sheet_source || '',
                    last_synced: row.last_synced || ''
                };

                // Extract status
                const statusInfo = extractStatus(project.status);
                project.statusEmoji = statusInfo.emoji;
                project.statusText = statusInfo.text;
                project.statusDate = statusInfo.date;
                project.statusClass = getStatusClass(project.statusEmoji);

                // Calculate amounts
                project.usdContractAmount = extractAndConvertToUSD(project.contract_amount);
                project.usdFundClaimed = extractAndConvertToUSD(project.fund_claimed);
                project.usdFundReceived = extractAndConvertToUSD(project.fund_received);
                project.usdTotalDue = extractAndConvertToUSD(project.total_due);

                // Calculate funding progress
                project.fundingProgressPercentage = calculateFundingProgress(
                    project.usdContractAmount,
                    project.usdFundReceived
                );

                // Check overdue
                project.isOverdue = isProjectOverdue(project);

                return project;
            }).filter(p => p.project_name && p.project_name.trim() !== '');

            // Setup filters
            setupFilters();

            // Display data
            filteredData = [...allData];
            displayProjectsGrid(filteredData);

            // Select first project
            if (filteredData.length > 0) {
                setTimeout(() => selectFirstProjectByDefault(), 100);
            }
        }

        function setupFilters() {
            const sectors = [...new Set(allData.map(p => p.sector).filter(Boolean).sort())];
            sectorFilter.innerHTML = '<option value="">All Sectors</option>' +
                sectors.map(s => `<option value="${s}">${s}</option>`).join('');
        }

        function displayProjectsGrid(projects) {
            if (projects.length === 0) {
                projectsGrid.innerHTML = `
                <div class="no-results">
                    <h3>No Projects Found</h3>
                    <p>Try adjusting your search or filters</p>
                </div>
            `;
                return;
            }

            projectsGrid.innerHTML = projects.map(project => {
                const isSelected = selectedProjectId === project.id;
                const statusIndicator = project.statusEmoji === 'ðŸŸ¢' ? 'On Track' :
                    project.statusEmoji === 'ðŸŸ¡' ? 'At Risk' :
                        project.statusEmoji === 'ðŸ”´' ? 'Critical' : 'Unknown';

                return `
                <div class="project-card ${project.statusClass} ${isSelected ? 'selected' : ''}" 
                     data-project-id="${project.id}"
                     role="button"
                     tabindex="0">
                    <div class="card-content">
                        <div class="project-name">${project.project_name || 'Unnamed Project'}</div>
                        <div class="project-code">${project.project_code || 'N/A'}</div>
                        ${project.isOverdue ? '<div class="overdue-badge">OVERDUE</div>' : ''}
                    </div>
                    <div class="card-status">
                        <div class="status-indicator ${getStatusIndicatorClass(project.statusEmoji)}">
                            ${project.statusEmoji || 'âšª'} ${statusIndicator}
                        </div>
                        ${project.statusDate ? `<div class="status-date">${project.statusDate}</div>` : ''}
                    </div>
                </div>
            `;
            }).join('');

            // Add click handlers
            document.querySelectorAll('.project-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (e.target.closest('a')) return;
                    const projectId = parseInt(card.dataset.projectId);
                    const project = allData.find(p => p.id == projectId);
                    if (project) {
                        handleCardClick(projectId, project);
                    }
                });

                // Add keyboard support
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const projectId = parseInt(card.dataset.projectId);
                        const project = allData.find(p => p.id == projectId);
                        if (project) {
                            handleCardClick(projectId, project);
                        }
                    }
                });
            });
        }

        function handleCardClick(projectId, project) {
            selectedProjectId = projectId;

            // Update card selection
            document.querySelectorAll('.project-card').forEach(card => {
                card.classList.remove('selected');
            });

            const clickedCard = document.querySelector(
                `.project-card[data-project-id="${projectId}"]`
            );
            if (clickedCard) clickedCard.classList.add('selected');

            // Show details
            displayProjectDetails(project);

            // Handle mobile view
            if (isMobile) {
                showDetailsView(project);

                // On mobile, scroll to top of details panel
                setTimeout(() => {
                    document.querySelector('.details-panel').scrollTop = 0;
                }, 100);
            } else {
                // On desktop, scroll to top of details body
                setTimeout(() => {
                    const detailsBody = document.getElementById('detailsBody');
                    if (detailsBody) {
                        detailsBody.scrollTop = 0;
                    }

                    // Also scroll the page to the top of the details panel
                    const detailsPanel = document.getElementById('detailsPanel');
                    if (detailsPanel) {
                        detailsPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
        }
        function displayProjectDetails(project) {
            // Hide empty state and show details view
            emptyState.style.display = 'none';
            projectDetailsView.classList.add('active');

            // Update header
            detailsProjectName.textContent = project.project_name || 'Unnamed Project';
            detailsClientName.textContent = project.client_name || 'N/A';

            const headerClass = project.statusEmoji === 'ðŸŸ¢' ? 'on-track' :
                project.statusEmoji === 'ðŸŸ¡' ? 'at-risk' :
                    project.statusEmoji === 'ðŸ”´' ? 'critical' : 'default';
            detailsHeader.className = `details-header ${headerClass}`;

            // Clear and rebuild details body
            detailsBody.innerHTML = '';

            // Create financial grid
            const financialGrid = document.createElement('div');
            financialGrid.className = 'financial-grid';
            financialGrid.innerHTML = `
                <div class="financial-card">
                    <div class="financial-value">${formatCurrency(project.usdContractAmount)}</div>
                    <div class="financial-label">Contract Amount</div>
                </div>
                <div class="financial-card">
                    <div class="financial-value">${formatCurrency(project.usdFundClaimed)}</div>
                    <div class="financial-label">Fund Claimed</div>
                </div>
                <div class="financial-card">
                    <div class="financial-value">${formatCurrency(project.usdFundReceived)}</div>
                    <div class="financial-label">Fund Received</div>
                </div>
                <div class="financial-card">
                    <div class="financial-value">${formatCurrency(project.usdTotalDue)}</div>
                    <div class="financial-label">Total Due</div>
                </div>
            `;
            detailsBody.appendChild(financialGrid);

            // Create details sections
            const detailsSections = document.createElement('div');
            detailsSections.className = 'details-sections';
            detailsSections.innerHTML = `
                <div class="details-section">
                    <h3 class="details-section-title">Project Overview</h3>
                    <div class="detail-item">
                        <div class="detail-item-label">Project Code</div>
                        <div class="detail-item-value">${project.project_code || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Sector</div>
                        <div class="detail-item-value">${project.sector || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Country</div>
                        <div class="detail-item-value">${project.country || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Status</div>
                        <div class="detail-item-value">${project.statusText || 'N/A'}</div>
                    </div>
                </div>
                <div class="details-section">
                    <h3 class="details-section-title">Team & Timeline</h3>
                    <div class="detail-item">
                        <div class="detail-item-label">Lead</div>
                        <div class="detail-item-value">${project.lead || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Partner</div>
                        <div class="detail-item-value">${project.partner || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Start Date</div>
                        <div class="detail-item-value">${project.contract_start_date || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">End Date</div>
                        <div class="detail-item-value">${project.end_date || 'N/A'}</div>
                    </div>
                </div>
            `;
            detailsBody.appendChild(detailsSections);

            // Create description card
            const descriptionCard = document.createElement('div');
            descriptionCard.className = 'description-card';
            descriptionCard.innerHTML = `
                <div class="description-label">Current Progress</div>
                <div class="description-value">${project.current_progress || 'N/A'}</div>
            `;
            detailsBody.appendChild(descriptionCard);

            // Create additional info section
            const additionalSection = document.createElement('div');
            additionalSection.className = 'details-section';
            additionalSection.innerHTML = `
                <h3 class="details-section-title">Additional Information</h3>
                <div class="detail-item">
                    <div class="detail-item-label">Key Risks</div>
                    <div class="detail-item-value">${project.key_risk_challenges || 'N/A'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-item-label">Next Milestone</div>
                    <div class="detail-item-value">${project.next_milestone || 'N/A'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-item-label">Remarks</div>
                    <div class="detail-item-value">${project.remark || 'N/A'}</div>
                </div>
            `;
            detailsBody.appendChild(additionalSection);

            // Create Links and Resources Section
            const linksSection = document.createElement('div');
            linksSection.className = 'links-resources-section';
            linksSection.innerHTML = `
                <h3 class="details-section-title">Links & Resources</h3>
                <div class="links-resources-grid">
                    <a href="#" class="resource-card" id="projectLinkCard" target="_blank" style="${project.links ? '' : 'display: none;'}">
                        <div class="resource-icon">
                            <i class="fas fa-external-link-alt"></i>
                        </div>
                        <div class="resource-title">Project Link</div>
                        <div class="resource-link">
                            <i class="fas fa-external-link-alt"></i>
                            Open Link
                        </div>
                    </a>
                    
                    <a href="#" class="resource-card" id="actionTrackerCard" target="_blank" style="${project.links ? '' : 'display: none;'}">
                        <div class="resource-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="resource-title">Action Tracker</div>
                        <div class="resource-link">
                            <i class="fas fa-external-link-alt"></i>
                            Open Tracker
                        </div>
                    </a>
                    
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="resource-title">Award Year</div>
                        <div class="resource-value">${project.awarded_year || 'N/A'}</div>
                    </div>
                </div>
            `;
            detailsBody.appendChild(linksSection);

            // Update links for resource cards
            if (project.links) {
                const projectLinkCard = document.getElementById('projectLinkCard');
                const actionTrackerCard = document.getElementById('actionTrackerCard');

                if (projectLinkCard) {
                    projectLinkCard.href = project.links;
                    projectLinkCard.style.display = 'flex';
                }
                if (actionTrackerCard) {
                    actionTrackerCard.href = `${project.links}/action-tracker`;
                    actionTrackerCard.style.display = 'flex';
                }
            }

        }

        function selectFirstProjectByDefault() {
            if (filteredData.length > 0) {
                const firstProject = filteredData[0];
                selectedProjectId = firstProject.id;
                displayProjectDetails(firstProject);

                const firstCard = document.querySelector(`.project-card[data-project-id="${firstProject.id}"]`);
                if (firstCard) {
                    firstCard.classList.add('selected');
                }
            }
        }

        function filterProjects() {
            const searchTerm = searchInput.value.toLowerCase();
            const statusValue = statusFilter.value;
            const sectorValue = sectorFilter.value;

            filteredData = allData.filter(project => {
                const matchesSearch = !searchTerm ||
                    (project.project_name && project.project_name.toLowerCase().includes(searchTerm)) ||
                    (project.client_name && project.client_name.toLowerCase().includes(searchTerm)) ||
                    (project.project_code && project.project_code.toLowerCase().includes(searchTerm));

                const matchesStatus = !statusValue || project.statusEmoji === statusValue;
                const matchesSector = !sectorValue || project.sector === sectorValue;

                return matchesSearch && matchesStatus && matchesSector;
            });

            displayProjectsGrid(filteredData);

            if (filteredData.length > 0) {
                const firstProject = filteredData[0];
                selectedProjectId = firstProject.id;
                displayProjectDetails(firstProject);
            } else {
                showEmptyState();
            }
        }

        function clearAllFilters() {
            searchInput.value = '';
            statusFilter.value = '';
            sectorFilter.value = '';

            filteredData = [...allData];
            displayProjectsGrid(filteredData);

            if (filteredData.length > 0) {
                setTimeout(() => selectFirstProjectByDefault(), 100);
            }

            // Visual feedback
            const originalHTML = clearFiltersBtn.innerHTML;
            clearFiltersBtn.innerHTML = '<i class="fas fa-check"></i>';
            clearFiltersBtn.style.background = '#10b981';
            clearFiltersBtn.style.color = 'white';

            setTimeout(() => {
                clearFiltersBtn.innerHTML = originalHTML;
                clearFiltersBtn.style.background = '';
                clearFiltersBtn.style.color = '';
            }, 1500);
        }

        function handleMobileBack() {
            if (isMobile) {
                showCardsView();
            }
        }

        function showEmptyState() {
            emptyState.style.display = 'flex';
            projectDetailsView.classList.remove('active');

            if (isMobile) {
                showCardsView();
            }
        }

        // Helper functions
        function extractStatus(statusData) {
            if (typeof statusData === 'string') {
                const cleanStatus = statusData.trim();
                let emoji = '', date = '';

                if (cleanStatus.includes('ðŸŸ¢')) emoji = 'ðŸŸ¢';
                else if (cleanStatus.includes('ðŸŸ¡')) emoji = 'ðŸŸ¡';
                else if (cleanStatus.includes('ðŸ”´')) emoji = 'ðŸ”´';

                const dateMatch = cleanStatus.match(/\d{1,2}\/\d{1,2}\/\d{4}/) ||
                    cleanStatus.match(/\d{1,2}-\d{1,2}-\d{4}/);
                if (dateMatch) date = dateMatch[0];

                return { emoji, date, text: getStatusText(emoji) };
            }
            return { emoji: '', date: '', text: 'Unknown' };
        }

        function getStatusClass(emoji) {
            return emoji === 'ðŸŸ¢' ? 'status-green' :
                emoji === 'ðŸŸ¡' ? 'status-yellow' :
                    emoji === 'ðŸ”´' ? 'status-red' : 'status-default';
        }

        function getStatusIndicatorClass(emoji) {
            return emoji === 'ðŸŸ¢' ? 'green' :
                emoji === 'ðŸŸ¡' ? 'yellow' :
                    emoji === 'ðŸ”´' ? 'red' : 'default';
        }

        function getStatusText(emoji) {
            return emoji === 'ðŸŸ¢' ? 'On Track' :
                emoji === 'ðŸŸ¡' ? 'At Risk' :
                    emoji === 'ðŸ”´' ? 'Critical' : 'Unknown';
        }

        // Format currency for display
        function formatCurrency(amount) {
            if (amount === 0 || !amount) return '$0';

            if (amount >= 1000000) {
                const millions = amount / 1000000;
                const formatted = new Intl.NumberFormat('en-US', {
                    minimumFractionDigits: 1,
                    maximumFractionDigits: 1
                }).format(millions);
                return '$' + formatted + 'M';
            } else if (amount >= 1000) {
                const thousands = amount / 1000;
                const formatted = new Intl.NumberFormat('en-US', {
                    minimumFractionDigits: 1,
                    maximumFractionDigits: 1
                }).format(thousands);
                return '$' + formatted + 'K';
            } else {
                return '$' + amount.toLocaleString('en-US', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
            }
        }

        // Initialize
        fetchProjects();
    </script>
</body>

</html>